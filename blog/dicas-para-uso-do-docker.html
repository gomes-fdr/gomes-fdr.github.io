<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="main.css" type="text/css" />
<link rel="stylesheet" href="blog.css" type="text/css" />
<link rel="alternate" type="application/rss+xml" title="Subscribe to this page..." href="feed.rss" />
<title>Dicas para uso do docker</title>
</head><body>
<div id="divbodyholder">
<div class="headerholder"><div class="header">
<div id="title">
<h1 class="nomargin"><a class="ablack" href="https://gomes-fdr.github.io/blog/index.html">Web notes</a></h1>
<div id="description">Alguns caracteres perdidos...</div>
</div></div></div>
<div id="divbody"><div class="content">
<!-- entry begin -->
<h3><a class="ablack" href="dicas-para-uso-do-docker.html">
Dicas para uso do docker
</a></h3>
<!-- bashblog_timestamp: #202005110757.24# -->
<div class="subtitle">May 11, 2020 &mdash; 
Fabiano Gomes
</div>
<!-- text begin -->

<p>Referencias utilizadas:
<a href="https://youtu.be/aHbE3pTyG-Q">link</a></p>

<p>Instalar um container - docker hub</p>

<pre><code>docker pull postgres:alpine
</code></pre>

<p>Listar containers instalados</p>

<pre><code>docker images -a
</code></pre>

<p>Remover um container</p>

<pre><code>docker rmi &lt;nome-do-container&gt;
</code></pre>

<p>Iniciar um container</p>

<pre><code>docker run --name postgres-0 -e POSTGRES_PASSWORD=1234 -d -p 5432:5432 postgres:alpine
</code></pre>

<p>Processo docker rodando</p>

<pre><code>docker ps
</code></pre>

<p>Para subir uma imagem existente</p>

<pre><code>docker start postgres-0 # &lt;container-name&gt;
</code></pre>

<p>Parar o container</p>

<pre><code> docker stop postgres-0 # &lt;container-name&gt;
</code></pre>

<p>Para entrar no container</p>

<pre><code>docker exec -it postgres-0 bash
</code></pre>

<p>Para acessar o banco de dados postgre dentro do container(console postgres)</p>

<pre><code>psql -U postgres
</code></pre>

<p>Para fazer o dump do banco do container</p>

<pre><code>docker exec -t postgres-0 pg_dumpall -a &gt; dump_`date +%d-%m-%Y"_"%H_%M_%S`.sql
docker exec -t postgres-0 pg_dump -a &gt; dump_`date +%d-%m-%Y"_"%H_%M_%S`.sql
</code></pre>

<p>Para restaurar o banco apartir de um dump file</p>

<pre><code>cat your_dump.sql | docker exec -i your-db-container psql -U postgres
</code></pre>

<p>VERIFICA SE A PORTA EST√Å EM USO</p>

<pre><code>netstat -an | grep 5432
</code></pre>

<p>STOP POSTGRE SERVICE</p>

<pre><code>sudo service postgresql stop
</code></pre>

<p>Copiar arquivo para container:</p>

<pre><code>docker cp &lt;arquivo&gt; &lt;container_id&gt;:/
</code></pre>

<p>Acessar o postgres do container:</p>

<pre><code>psql -h localhost -p 5432 -U postgres
</code></pre>

<p>Para criar um novo banco no postgre via CL:</p>

<pre><code>createdb -U &lt;role&gt; &lt;nome-banco&gt;
</code></pre>

<h2>Outra maneira de fazer o backup</h2>

<pre><code>docker exec -u &lt;your_postgres_user&gt; &lt;postgres_container_name&gt; pg_dump -Fc &lt;database_name_here&gt; &gt; db.dump
</code></pre>

<h2>Cuidado!</h2>

<pre><code>docker exec -u &lt;your_postgres_user&gt; &lt;postgres_container_name&gt; psql -c 'DROP DATABASE &lt;your_db_name&gt;'

docker exec -i -u &lt;your_postgres_user&gt; &lt;postgres_container_name&gt; pg_restore -C -d postgres &lt; db.dump
</code></pre>

<p>Exemplo:</p>

<p>Custom format (c)</p>

<pre><code>docker exec -u labwide postgres-0 pg_dump -Fc gestam-dados &gt; gestam-dados.dump
</code></pre>

<p>SQL format(p)</p>

<pre><code>docker exec -u postgres postgres-0 pg_dump -Fp gestam-dados &gt; gestam-dados.dump
</code></pre>

<h2>Backup acessando o container</h2>

<p><strong>copy dump into container</strong></p>

<pre><code>docker cp local/path/to/db.dump CONTAINER_ID:/db.dump
</code></pre>

<p><strong>shell into container</strong></p>

<pre><code>docker exec -it CONTAINER_ID bash
</code></pre>

<p><strong>restore it from within</strong></p>

<pre><code>pg_restore -U postgres -d DB_NAME --no-owner -1 /db.dump
</code></pre>

<p>Tags: <a href='tag_wiki.html'>wiki</a></p>
<!-- text end -->
<!-- entry end -->
</div>
<div id="footer">CC by-nc-nd <a href="">Fabiano Gomes</a> &mdash; <a href="mailto:gomes&#46;fdr&#64;gmail&#46;com">gomes&#46;fdr&#64;gmail&#46;com</a><br/>
Generated with <a href="https://github.com/cfenollosa/bashblog">bashblog</a>, a single bash script to easily create blogs like this one</div>
</div></div>
</body></html>
